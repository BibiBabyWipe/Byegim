<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Wife's Cool Movie Reviews</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&display=swap" rel="stylesheet">
    <style>
        /* Your existing CSS styles */
        :root {
            --primary-color: #a0d2eb; /* Pastel blue */
            --secondary-color: #e5eaf5; /* Light lavender */
            --accent-color: #d0bdf4; /* Soft purple */
            --background-color: #fff0f5; /* Lavender blush */
            --card-background: #ffffff;
            --text-color: #494d5f; /* Dark slate */
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
        }

        body {
            font-family: 'Roboto Mono', monospace; /* Monospaced font */
            text-align: center; /* Center all text */
            background-color: var(--background-color);
            color: var(--text-color);
            background-image: 
                radial-gradient(circle at 10% 20%, var(--secondary-color) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, var(--accent-color) 0%, transparent 20%);
            background-attachment: fixed;
        }

        h1 {
            color: var(--primary-color);
            text-shadow: 2px 2px 4px rgba(160, 210, 235, 0.3);
            font-size: 3em;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .review {
            background-color: var(--card-background);
            border-radius: 20px;
            border: 2px solid var(--accent-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .review:hover {
            transform: translateY(-5px) rotate(1deg);
            box-shadow: 0 8px 15px rgba(208, 189, 244, 0.3);
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            font-family: 'Quicksand', sans-serif;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(160, 210, 235, 0.2);
        }

        button:hover {
            background-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(208, 189, 244, 0.3);
        }

        .review img {
            width: 150px; /* Set a maximum width for movie posters */
            height: auto; /* Maintain aspect ratio */
        }

        .movie-info {
            margin-top: 15px;
            font-size: 0.9em;
            color: #666;
        }

        /* Additional styles omitted for brevity */

        .container {
            max-width: 800px; /* Adjusted width for better display */
            margin: 0 auto;
            padding: 20px;
        }

        .review {
            max-width: 300px; /* Set a maximum width for review cards */
            margin: 10px; /* Center reviews */
            display: inline-block; /* Allow reviews to be inline */
            vertical-align: top; /* Align reviews to the top */
        }

        .review img {
            width: 100px; /* Set a smaller width for movie posters */
            height: auto; /* Maintain aspect ratio */
        }

        .cast img {
            width: 50px; /* Set a smaller width for cast images */
            height: auto; /* Maintain aspect ratio */
            border-radius: 50%; /* Make cast images circular */
        }

        #add-review-form {
            display: none; /* Hide the form initially */
        }

        /* Responsive layout for reviews */
        @media (max-width: 768px) {
            .review {
                max-width: 100%; /* Full width on mobile */
                display: block; /* Stack reviews vertically */
            }
        }

        /* Additional styles for form layout */
        #add-review-form input, #add-review-form textarea {
            width: 100%; /* Full width for inputs */
            margin-bottom: 10px; /* Space between fields */
            padding: 10px; /* Padding for inputs */
            border-radius: 5px; /* Rounded corners */
            border: 1px solid #ccc; /* Border style */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>My Wife's Cool Movie Reviews</h1>
        
        <div id="poster-carousel"></div>
        
        <div id="sort-options">
            <button id="sort-rating"><i class="fas fa-star"></i> Sort by Rating</button>
            <button id="sort-date"><i class="fas fa-calendar-alt"></i> Sort by Date</button>
            <button id="sort-length"><i class="fas fa-clock"></i> Sort by Movie Length</button>
        </div>
        
        <div id="reviews"></div>

        <button id="show-add-review"><i class="fas fa-plus-circle"></i> Add Review</button>

        <div id="add-review-form">
            <input type="text" id="review-title" placeholder="Movie Title">
            <button id="fetch-movie-details">Fetch Movie Details</button>
            <input type="text" id="review-poster" placeholder="Poster URL" readonly>
            <input type="number" id="review-length" placeholder="Movie Length (minutes)" readonly>
            <input type="text" id="review-director" placeholder="Director" readonly>
            <div class="cast"></div> <!-- Cast images will be displayed here -->
            <textarea id="review-content" placeholder="Short Summary (Auto-filled)" readonly></textarea>
            <input type="date" id="review-date">
            <input type="number" id="review-rating" min="1" max="5" placeholder="Rating (1-5)">
            <textarea id="personal-thoughts" placeholder="Your Personal Thoughts"></textarea>
            <!-- Password Input Field -->
            <input type="password" id="review-password" placeholder="Enter Password" required>
            
            <button id="submit-review">Submit Review</button>
        </div>
    </div>

    <script type="module">
        // Import Firebase functions
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB5fwg700iEVDVEqevzLRL0IiEUIr9Zsrs",
            authDomain: "byegim-3c560.firebaseapp.com",
            projectId: "byegim-3c560",
            storageBucket: "byegim-3c560.appspot.com",
            messagingSenderId: "152311979426",
            appId: "1:152311979426:web:466634e40914d0adf9e6fb",
            measurementId: "G-S63K1X2ST1"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function fetchMovieInfo(title) {
            const TMDB_API_KEY = '12082b6a4d012c96fba4c4af9565f9d3'; // Your actual TMDB API key
            try {
                const searchResponse = await fetch(`https://api.themoviedb.org/3/search/movie?api_key=${TMDB_API_KEY}&query=${encodeURIComponent(title)}`);
                if (!searchResponse.ok) {
                    throw new Error(`HTTP error! status: ${searchResponse.status}`);
                }
                const searchData = await searchResponse.json();
                console.log('Search Data:', searchData); // Debug log to inspect the response

                if (searchData.results && searchData.results.length > 0) {
                    const movie = searchData.results[0];
                    const detailsResponse = await fetch(`https://api.themoviedb.org/3/movie/${movie.id}?api_key=${TMDB_API_KEY}&append_to_response=credits`);
                    if (!detailsResponse.ok) {
                        throw new Error(`HTTP error! status: ${detailsResponse.status}`);
                    }
                    const detailsData = await detailsResponse.json();
                    console.log('Details Data:', detailsData); // Debug log to inspect the details response

                    return {
                        poster: movie.poster_path ? `https://image.tmdb.org/t/p/w500${movie.poster_path}` : null,
                        cast: detailsData.credits.cast.slice(0, 3).map(actor => ({
                            name: actor.name,
                            profile_path: actor.profile_path ? `https://image.tmdb.org/t/p/w500${actor.profile_path}` : null
                        })),
                        overview: movie.overview,
                        year: movie.release_date ? movie.release_date.split('-')[0] : 'N/A',
                        genre: detailsData.genres.map(g => g.name).join(', '),
                        length: detailsData.runtime || 'N/A', // Get movie length
                        director: detailsData.credits.crew.find(member => member.job === 'Director')?.name || 'N/A' // Get director
                    };
                } else {
                    console.error('No results found for the movie title:', title); // Log if no results found
                    return null;
                }
            } catch (error) {
                console.error('Error fetching movie info:', error);
                return null;
            }
        }

        async function displayReviews() {
            const reviewsContainer = document.getElementById('reviews');
            reviewsContainer.innerHTML = ''; // Clear existing reviews
            const querySnapshot = await getDocs(collection(db, "reviews"));
            if (querySnapshot.empty) {
                console.log('No reviews found in Firestore.'); // Log if no reviews found
                return; // Exit if there are no reviews
            }
            querySnapshot.forEach((doc) => {
                const review = doc.data();
                const reviewElement = document.createElement('div');
                reviewElement.className = 'review';
                reviewElement.innerHTML = `
                    <img src="${review.poster}" alt="${review.title}">
                    <h3>${review.title} (${review.year})</h3>
                    <p>Rating: ${getStars(review.rating)}</p>
                    <p>Date: ${review.date}</p>
                    <p>Length: ${review.length} minutes</p>
                    <div class="movie-info">
                        <p><strong>Genre:</strong> ${review.genre}</p>
                        <p><strong>Cast:</strong></p>
                        <div class="cast">
                            ${Array.isArray(review.cast) ? review.cast.map(actor => actor.profile_path ? `<img src="${actor.profile_path}" alt="${actor.name}" title="${actor.name}">` : '').join('') : 'N/A'}
                        </div>
                        <p><strong>Director:</strong> ${review.director || 'N/A'}</p>
                        <p><strong>Overview:</strong> ${review.overview}</p>
                    </div>
                    <div class="personal-thoughts" style="margin-top: 15px; padding: 10px; border: 1px solid #d0bdf4; border-radius: 5px; background-color: #f9f9f9;">
                        <strong>Your Personal Thoughts:</strong>
                        <p>${review.personalThoughts || 'No personal thoughts provided.'}</p>
                    </div>
                `;
                reviewsContainer.appendChild(reviewElement);
            });
        }

        function getStars(rating) {
            return Array(5).fill('☆').map((star, index) => 
                `<span class="star" style="animation-delay: ${index * 0.1}s">
                    ${index < rating ? '★' : '☆'}
                </span>`
            ).join('');
        }

        async function addReview() {
            const title = document.getElementById('review-title').value;
            const poster = document.getElementById('review-poster').value;
            const rating = document.getElementById('review-rating').value;
            const date = document.getElementById('review-date').value;
            const length = document.getElementById('review-length').value;
            const content = document.getElementById('review-content').value;
            const personalThoughts = document.getElementById('personal-thoughts').value;
            const password = document.getElementById('review-password').value;

            // Hardcoded password (for demonstration purposes)
            const correctPassword = 'WeLoveZere'; // Change this to your desired password

            // Check if the entered password is correct
            if (password !== correctPassword) {
                alert('Incorrect password. You cannot submit a review.');
                return;
            }

            const movieInfo = await fetchMovieInfo(title);
            if (!movieInfo) {
                alert('Movie not found. Please check the title.');
                return;
            }

            const reviewData = {
                title: title,
                poster: poster || movieInfo.poster,
                rating: rating,
                date: date,
                length: length,
                overview: movieInfo.overview,
                cast: movieInfo.cast, // Ensure this is an array
                genre: movieInfo.genre,
                year: movieInfo.year,
                personalThoughts: personalThoughts,
                director: movieInfo.director // Add director to the review data
            };

            try {
                await addDoc(collection(db, "reviews"), reviewData);
                alert('Review added successfully!');
                displayReviews(); // Refresh the reviews display
            } catch (error) {
                console.error('Error adding review:', error);
            }
        }

        function setTodayDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            document.getElementById('review-date').value = `${year}-${month}-${day}`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('fetch-movie-details').addEventListener('click', async () => {
                const title = document.getElementById('review-title').value;
                const movieInfo = await fetchMovieInfo(title);
                if (movieInfo) {
                    document.getElementById('review-poster').value = movieInfo.poster;
                    document.getElementById('review-length').value = movieInfo.length || '';
                    document.getElementById('review-content').value = movieInfo.overview;
                } else {
                    alert('Movie not found. Please check the title.');
                }
            });

            document.getElementById('submit-review').addEventListener('click', addReview);
            displayReviews(); // Load existing reviews on page load
        });

        document.getElementById('show-add-review').addEventListener('click', () => {
            const form = document.getElementById('add-review-form');
            form.style.display = form.style.display === 'none' ? 'block' : 'none'; // Toggle visibility
            setTodayDate(); // Set today's date when the form is shown
        });
    </script>
</body>
</html>
