<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Wife's Cool Movie Reviews</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        :root {
            --primary-color: #ff6b6b;
            --secondary-color: #4ecdc4;
            --background-color: #292f36;
            --card-background: #ffffff;
            --text-color: #333333;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
        }

        body {
            font-family: 'Arial', sans-serif; /* Set a single font for the entire site */
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255, 107, 107, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(78, 205, 196, 0.1) 0%, transparent 20%);
            background-attachment: fixed;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 30px;
            font-weight: 700;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        #poster-carousel {
            width: 100%;
            height: 400px;
            overflow: hidden;
            position: relative;
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .poster {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease-in-out;
        }

        #reviews {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .review {
            background-color: var(--card-background);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            color: var(--background-color);
        }

        .review:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15), 0 3px 6px rgba(0, 0, 0, 0.1);
        }

        .review img {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .star {
            color: gold;
            font-size: 1.2em;
        }

        #sort-options {
            margin-bottom: 20px;
            text-align: center;
        }

        button {
            margin: 0 5px;
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease, transform 0.3s ease;
            box-shadow: var(--shadow);
        }

        button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        #add-review-form {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background-color: var(--card-background);
            border-radius: 12px;
            box-shadow: var(--shadow);
            color: var(--background-color);
        }

        #add-review-form input, #add-review-form textarea {
            width: 100%;
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        #add-review-form button {
            width: 100%;
        }

        .movie-info {
            margin-top: 15px;
            font-size: 0.9em;
            color: #666;
        }

        .date-input-container {
            display: flex;
            align-items: center;
            gap: 5px; /* Reduced gap for better alignment */
            margin-bottom: 15px;
        }

        .date-input-container input[type="date"] {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .date-input-container button {
            width: 30px; /* Fixed width */
            height: 30px; /* Fixed height */
            padding: 0;
            font-size: 14px; /* Adjusted font size */
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease, transform 0.3s ease;
        }

        .date-input-container button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            h1 {
                font-size: 2em;
            }

            #poster-carousel {
                height: 300px;
            }

            #reviews {
                grid-template-columns: 1fr;
            }

            button {
                padding: 8px 16px;
                font-size: 14px;
            }
        }

        .floating-element {
            position: fixed;
            width: 50px;
            height: 50px;
            background-color: var(--primary-color);
            border-radius: 50%;
            opacity: 0.7;
            pointer-events: none;
            z-index: -1;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>My Wife's Cool Movie Reviews</h1>
        
        <div id="poster-carousel"></div>
        
        <div id="sort-options">
            <button onclick="sortReviews('rating')">Sort by Rating</button>
            <button onclick="sortReviews('date')">Sort by Date</button>
            <button onclick="sortReviews('length')">Sort by Movie Length</button>
        </div>
        
        <div id="reviews"></div>

        <button onclick="showAddReviewForm()">Add Review</button>

        <div id="add-review-form">
            <input type="password" id="review-password" placeholder="Password">
            <input type="text" id="review-title" placeholder="Movie Title">
            <button onclick="fetchMovieDetails()">Fetch Movie Details</button>
            <input type="text" id="review-poster" placeholder="Poster URL" readonly>
            <input type="number" id="review-rating" min="1" max="5" placeholder="Rating (1-5)">
            <div class="date-input-container">
                <input type="date" id="review-date">
                <button onclick="setTodayDate()" title="Set to today's date">T</button>
            </div>
            <input type="number" id="review-length" placeholder="Movie Length (minutes)" readonly>
            <textarea id="review-content" placeholder="Movie Details (Auto-filled)" readonly></textarea>
            <textarea id="personal-thoughts" placeholder="Your Personal Thoughts"></textarea>
            <button onclick="addReview()">Submit Review</button>
        </div>
    </div>

    <script>
        const TMDB_API_KEY = '12082b6a4d012c96fba4c4af9565f9d3';

        // Sample data (replace with actual data from a database)
        const reviews = [
            { title: "Inception", poster: "https://example.com/inception.jpg", rating: 5, date: "2023-06-15", length: 148 },
            { title: "The Shawshank Redemption", poster: "https://example.com/shawshank.jpg", rating: 5, date: "2023-06-10", length: 142 },
            { title: "Pulp Fiction", poster: "https://example.com/pulpfiction.jpg", rating: 4, date: "2023-06-05", length: 154 },
        ];

        async function fetchMovieInfo(title) {
            try {
                const searchResponse = await fetch(`https://api.themoviedb.org/3/search/movie?api_key=${TMDB_API_KEY}&query=${encodeURIComponent(title)}`);
                if (!searchResponse.ok) {
                    throw new Error(`HTTP error! status: ${searchResponse.status}`);
                }
                const searchData = await searchResponse.json();
                console.log('Search data:', searchData); // Debug log
                if (searchData.results && searchData.results.length > 0) {
                    const movie = searchData.results[0];
                    const detailsResponse = await fetch(`https://api.themoviedb.org/3/movie/${movie.id}?api_key=${TMDB_API_KEY}&append_to_response=credits`);
                    if (!detailsResponse.ok) {
                        throw new Error(`HTTP error! status: ${detailsResponse.status}`);
                    }
                    const detailsData = await detailsResponse.json();
                    console.log('Details data:', detailsData); // Debug log
                    return {
                        poster: movie.poster_path ? `https://image.tmdb.org/t/p/w500${movie.poster_path}` : null,
                        cast: detailsData.credits.cast.slice(0, 3).map(actor => actor.name).join(', '),
                        overview: movie.overview,
                        year: movie.release_date ? movie.release_date.split('-')[0] : 'N/A',
                        genre: detailsData.genres.map(g => g.name).join(', ')
                    };
                }
                return null;
            } catch (error) {
                console.error('Error fetching movie info:', error);
                return null;
            }
        }

        async function displayReviews() {
            const reviewsContainer = document.getElementById('reviews');
            reviewsContainer.innerHTML = '';
            for (const review of reviews) {
                try {
                    const movieInfo = await fetchMovieInfo(review.title);
                    const reviewElement = document.createElement('div');
                    reviewElement.className = 'review';
                    reviewElement.innerHTML = `
                        <img src="${movieInfo && movieInfo.poster ? movieInfo.poster : review.poster}" alt="${review.title}">
                        <h3>${review.title} ${movieInfo ? `(${movieInfo.year})` : ''}</h3>
                        <p>Rating: ${getStars(review.rating)}</p>
                        <p>Date: ${review.date}</p>
                        <p>Length: ${review.length} minutes</p>
                        ${movieInfo ? `
                            <div class="movie-info">
                                <p><strong>Genre:</strong> ${movieInfo.genre}</p>
                                <p><strong>Cast:</strong> ${movieInfo.cast}</p>
                                <p><strong>Overview:</strong> ${movieInfo.overview}</p>
                            </div>
                        ` : ''}
                    `;
                    reviewsContainer.appendChild(reviewElement);
                } catch (error) {
                    console.error('Error displaying review:', error);
                }
            }
        }

        function getStars(rating) {
            return '★'.repeat(rating) + '☆'.repeat(5 - rating);
        }

        function sortReviews(criteria) {
            reviews.sort((a, b) => {
                if (criteria === 'rating') return b.rating - a.rating;
                if (criteria === 'date') return new Date(b.date) - new Date(a.date);
                if (criteria === 'length') return b.length - a.length;
            });
            displayReviews();
        }

        function rotatePoster() {
            const carousel = document.getElementById('poster-carousel');
            const posters = reviews.map(review => review.poster);
            let currentIndex = 0;

            function showNextPoster() {
                const img = document.createElement('img');
                img.src = posters[currentIndex];
                img.className = 'poster';
                img.style.transform = 'translateX(100%)';
                carousel.appendChild(img);

                setTimeout(() => {
                    if (carousel.children.length > 1) {
                        carousel.children[0].style.transform = 'translateX(-100%)';
                        carousel.children[1].style.transform = 'translateX(0)';
                        setTimeout(() => carousel.removeChild(carousel.children[0]), 500);
                    } else {
                        img.style.transform = 'translateX(0)';
                    }
                }, 50);

                currentIndex = (currentIndex + 1) % posters.length;
            }

            showNextPoster();
            setInterval(showNextPoster, 5000);
        }

        function showAddReviewForm() {
            document.getElementById('add-review-form').style.display = 'block';
            setTodayDate(); // Set the default date to today when the form is shown
        }

        function setTodayDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            document.getElementById('review-date').value = `${year}-${month}-${day}`;
        }

        async function fetchMovieDetails() {
            const title = document.getElementById('review-title').value;
            if (!title) {
                alert('Please enter a movie title');
                return;
            }

            try {
                const searchResponse = await fetch(`https://api.themoviedb.org/3/search/movie?api_key=${TMDB_API_KEY}&query=${encodeURIComponent(title)}`);
                if (!searchResponse.ok) {
                    throw new Error(`HTTP error! status: ${searchResponse.status}`);
                }
                const searchData = await searchResponse.json();
                console.log('Search data:', searchData);

                if (searchData.results && searchData.results.length > 0) {
                    const movie = searchData.results[0];
                    const detailsResponse = await fetch(`https://api.themoviedb.org/3/movie/${movie.id}?api_key=${TMDB_API_KEY}&append_to_response=credits`);
                    if (!detailsResponse.ok) {
                        throw new Error(`HTTP error! status: ${detailsResponse.status}`);
                    }
                    const detailsData = await detailsResponse.json();
                    console.log('Details data:', detailsData);

                    // Fill in the form fields
                    document.getElementById('review-poster').value = movie.poster_path ? `https://image.tmdb.org/t/p/w500${movie.poster_path}` : '';
                    document.getElementById('review-length').value = detailsData.runtime || '';
                    document.getElementById('review-title').value = movie.title;

                    // Auto-fill the review content with movie info
                    document.getElementById('review-content').value = `${movie.title} (${movie.release_date.split('-')[0]})\n\nOverview: ${movie.overview}\n\nCast: ${detailsData.credits.cast.slice(0, 3).map(actor => actor.name).join(', ')}`;

                } else {
                    alert('Movie not found');
                }
            } catch (error) {
                console.error('Error fetching movie details:', error);
                alert('Error fetching movie details. Please try again.');
            }
        }

        async function addReview() {
            const password = document.getElementById('review-password').value;
            if (password !== 'your_secret_password') {
                alert('Incorrect password');
                return;
            }

            const title = document.getElementById('review-title').value;
            const poster = document.getElementById('review-poster').value;
            const rating = document.getElementById('review-rating').value;
            const date = document.getElementById('review-date').value;
            const length = document.getElementById('review-length').value;
            const content = document.getElementById('review-content').value;
            const personalThoughts = document.getElementById('personal-thoughts').value;

            const reviewHtml = `
                <!-- REVIEW_START
                {
                    "title": "${title}",
                    "poster": "${poster}",
                    "rating": ${rating},
                    "date": "${date}",
                    "length": ${length}
                }
                ${content}

                Personal Thoughts:
                ${personalThoughts}
                REVIEW_END -->
            `;

            // In a real scenario, you'd send this to a server to append to the HTML file
            console.log('New review:', reviewHtml);
            alert('Review added! (In a real scenario, this would be saved to the file)');

            // Clear the form
            document.getElementById('add-review-form').reset();
            document.getElementById('add-review-form').style.display = 'none';
        }

        // Modify loadReviews to use some sample data for testing
        async function loadReviews() {
            const reviews = JSON.parse(localStorage.getItem('movieReviews')) || [];
            if (reviews.length === 0) {
                await fetchSampleMovies(); // Fetch sample movies if no reviews are stored
            } else {
                reviews.forEach(review => {
                    displayReview(review);
                });
            }
        }

        // Initialize the page
        async function init() {
            try {
                await loadReviews();
                rotatePoster();
            } catch (error) {
                console.error('Error initializing page:', error);
            }
        }

        // Call init when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', init);

        function createFloatingElement() {
            const element = document.createElement('div');
            element.classList.add('floating-element');
            element.style.left = `${Math.random() * 100}vw`;
            element.style.top = `${Math.random() * 100}vh`;
            document.body.appendChild(element);

            const animationDuration = 5000 + Math.random() * 5000;
            element.animate([
                { transform: 'translate(0, 0)' },
                { transform: `translate(${Math.random() * 200 - 100}px, ${Math.random() * 200 - 100}px)` }
            ], {
                duration: animationDuration,
                iterations: Infinity,
                direction: 'alternate',
                easing: 'ease-in-out'
            });
        }

        for (let i = 0; i < 5; i++) {
            createFloatingElement();
        }

        window.addEventListener('scroll', () => {
            const scrollPercentage = (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
            document.body.style.backgroundPosition = `10% ${20 + scrollPercentage * 0.5}%, 90% ${80 - scrollPercentage * 0.5}%`;
        });

        async function fetchSampleMovies() {
            try {
                const response = await fetch(`https://api.themoviedb.org/3/movie/popular?api_key=${TMDB_API_KEY}&language=en-US&page=1`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                const movies = data.results.slice(0, 3); // Get the first 3 movies for demonstration
                movies.forEach(movie => {
                    const review = {
                        title: movie.title,
                        poster: movie.poster_path ? `https://image.tmdb.org/t/p/w500${movie.poster_path}` : '',
                        rating: movie.vote_average,
                        date: new Date(movie.release_date).toLocaleDateString(),
                        length: movie.runtime || 'N/A', // TMDb doesn't provide runtime in popular movies endpoint
                        content: movie.overview,
                        personalThoughts: "Looking forward to watching this!"
                    };
                    displayReview(review);
                });
            } catch (error) {
                console.error('Error fetching sample movies:', error);
            }
        }

        // Call this function when the page loads
        document.addEventListener('DOMContentLoaded', async () => {
            await fetchSampleMovies();
        });
    </script>
</body>
</html>
